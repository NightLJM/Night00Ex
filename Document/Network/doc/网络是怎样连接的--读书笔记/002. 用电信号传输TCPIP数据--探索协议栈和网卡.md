## **002.用电信号传输TCP/IP数据--探索协议栈和网卡**

1. TCP建立链接的过程不细说了，具体参见：[TCP三次握手与四次挥手][1]
2. 应用层数据传到网络层后，并不会立即发出去，而是将其放入内部缓冲区，并等待下一次数据。当数据积累到一定程度时就会发出去。数据何时发出有两个参考依据：
    1. MTU：最大传输单元。即网络包的最大长度，以太网通常是1500字节。MTU是包含头部的总长度。MSS是MTU减掉头部后，一个网络包所能容纳的TCP数据的最大的多多大长度。
    2. 时间。有一个定时器，当经过一定时间后，会将网络包发出去。
3. 报文格式：    
![报文格式][2]
4. 当发送缓冲区的数据长度大于MSS长度时，数据会进行拆分，如下图所示：    
![数据拆分格式][3]
5. 超时时间：若TCP的数据发送方发送数据后，经过了一个指定时间，还没有收到接收方的ACK确认，则对此数据进行重传，这一指定时间就是超时时间。超时时间是一个动态调整的时间，如果ACK返回快，则缩短超时时间；反之，则延长超时时间。超时时间有个最小值，基本是0.5秒到1秒之间。
6. 拥塞控制。      
    1. cwnd: 拥塞窗口大小
    2. ssthresh：满开始阈值
![拥塞控制][4]
7. IP协议与MAC协议的作用：
    1. IP：根据目的IP地址确定下一跳转发设备的位置(MAC地址)。
    2. MAC：将数据包传到指定设备。
8. 路由表：根据目的IP地址查询下一跳的IP地址
9. ARP协议：地址解析协议，查询目标路由器的MAC地址。
    1. 基础：以太网中，有种叫做广播的东西，可以把包发给连接在同一局域网的所有设备。
    2. ARP协议要求发送放通过广播向局域网的其他设备询问要到目标IP地址的下一跳MAC地址(广播会附带自己的IP地址和MAC地址)，若某设备是下一跳，则该设备通过单播的方式进行ARP回应。其他不是下一跳的设备不做回应。
10. 向DNS查询IP地址用的是UDP协议。












[1]: https://www.cnblogs.com/bj-mr-li/p/11106390.html
[2]: ./../image/002-1.报文格式.png
[3]: ./../image/002-2.数据拆分格式.png
[4]: ./../image/002-3.拥塞控制.png