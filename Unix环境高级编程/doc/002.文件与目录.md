## **002.文件与目录**

### **1 stat、fstat、fstatat、lstata**

1.1 int stat(const char* restrict pathname, struct stat* restrict buf);
  1. pathname：文件名； buf：与该文件相关的信息结构    
  2. 作用：得到文件相关信息   

1.2 int fstat(int fd, struct stat* buf);
  1. fd：描述符
  2. 作用同stat   

1.3 int lstat(const char* restrict pathname, struct stat* restrict buf);
  1. 作用：与stat类似，但是，当路径名是符号链接时，返回的是该符号链接的信息，而不是符号链接指向的文件;   

1.4 int fstatat(int fd, const char* restrict pathname, struct stat* restrict buf, int flag);
  1. 作用：根据fd指定的相对路径返回文件信息；若pathname时绝对路径，则fd无效;
  2. fd的值为AT_FDCWD时，则fd表示的是当前目录；
  3. flag的AT_SYMLINK_NOFLLOW标志被设置时，fstatat不会跟踪符号链接，即返回符号链接本身的信息；其他情况，若文件是符号链接的话，返回的就是符号链接指向的文件的信息；   


### **2 文件类型**

2.1 分类
  1. 普通文件：可以是文本文件和二进制文件
  2. 目录文件：包含了其他文件的名字和指向这些文件有关信息的指针；只要对该目录文件有读权限，就可以读这个目录；但是，只有内核才可以直接写目录
  3. 块特殊文件：提供对设备(如磁盘)的带缓冲访问，每次访问以固定长度为单位执行。
  4. 字符特殊文件：提供对设备不带缓冲的访问，每次访问的长度可变；系统中所有设备要么是块设备，要么时字符设备
  5. FIFO：管道，用于进程间通信
  6. 套接字：用于进程间网络通信。也可以用于同一台机器上的不同进程进行非网络通信
  7. 符号链接：指向一个文件     

2.2 获取文件类型
  1. 通过stat系列的函数拿到文件的stat结构(假设为st)，用S_ISxxx(st.st_mode)宏获取文件类型。
  2. 宏有7种：S_ISREG(mode_t mode), S_ISDIR(mode_t mode), S_ISCHR(mode_t mode), S_ISBLK(mode_t mode), S_ISFIFO(mode_t mode), _ISLNK(mode_t mode), S_ISSOCK(mode_t mode)
  3. S_TYPEISMQ(stat*), S_TYPEISSEM(stat*), S_TYPEISSHM(stat*) 分别用来判断是不是消息队列、信号量以及共享存储      

2.3 文件访问权限
  1. 权限：读、写、执行；rwx
  2. 对目录具有执行权限才能搜索该目录，获取该目录内文件的信息；对有读权限则可以获取该目录中的文件列表(不能获取目录内文件的具体信息)；
  3. 对目录有执行权限而没读权限就不能获取该目录的文件名，即ls啥也得不到，但是可以进入该目录；对目录有读权限而没有执行权限的话，可以ls，但是只能得到目录里的文件名，不能得到目录里文件的具体信息，也不能进入该目录；   
  4. 使用exec函数执行某文件时，必须对该文件有执行权限，而且该文件还必须是可执行文件
  5. 进程对文件进行访问，若进程属于文件拥有者，则只检查是否具有所有者相应的访问权限，不检查组和其他人的访问权限；同理，若进程属于组，则只检查组对应的权限，而不检查其他人的权限。


### **3 一些函数**

3.1 access和faccess    
  1. int access(const char* pathname, int mode); 
  2. int faccess(int fd, const char* pathname, int mode, int flag); 
  3. 这俩函数用于获取进程实际用户对文件的权限
  4. pathname时相对路径的话使用faccess；绝对路径两个都能用。
  5. 如果测试文件是否存在，mode为F_OK；否则可以是下面标志位或者按位或：R_OK(读权限)、W_OK(写权限)、X_OK(可执行权限)    
  6. flag位如果时AT_EACESS，则函数测试的是调用进程的有效用户ID和有效组ID，而不是实际的用户ID和实际组ID          

3.2 umask
  1. mode_t umask(mode_t cmask);
  2. cmask是文件访问权限，包含S_IRUSER、S_IWUSER、S_IXUSER、S_IRGRP、S_IWGRP、S_IXGRP、S_IROTH、S_IWOTH、S_IXOTH；
  3. umask用于进程在创建文件或目录时，屏蔽相应的权限       
 
3.3 chmod、fchmod、fchmodat
  1. int chmod(const char* pathname, int mode);
  2. int fchmod(int fd, mote_t mode);
  3. int fchmodat(int fd, const char* pathname, mode_t mode, int flag);
  4. chmod在指定的文件上进行操作，fchmod在已经打开的文件上进行操作
  5. flag如果时AT_SYMLINK_NOFOLLOW的话，不会跟踪符号链接   
  6. 为了改变文件的权限位，进程的有效用户ID必须等于文件的所有者ID，或者进程必须具有超级用户权限   

3.4 





