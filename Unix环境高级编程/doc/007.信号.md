## **007.信号**

**7.1 概念**

1. 信号是软中断。不存在信号编号为0的信号。
2. 信号的处理方式：
    1. 忽略此信号。大多数信号可以以这种方式处理。但有两种信号决不能被忽略，SIGKILL和SIGSTOP。
    2. 捕捉信号。通知内核在某种信号发生时，调用一个用户函数。注意不能捕捉SIGKILL和SIGSTOP。
    3. 执行系统默认操作。大多数信号的系统默认操作都是终止该进程。

**7.2 signal函数**

``` C
void (*signal(int signo, void(*func)(int)))(int);
```

1. 返回值：若成功，返回之前的信号处理配置；若失败，返回SIG_ERR；
2. signo是信号名。fun可以是常量SIG_IGN，常量SIG_DEF或接收到此信号需要执行的函数的地址
    1. SIG_IGN：内核忽略此信号
    2. SIG_DEF：内核以默认的操作处理
    3. #define SIG_ERR (void (*)())-1
    4. #define SIG_DEL (void (*)())0
    5. #define SIG_IGN (void (*)())1
3. 通过kill命令可以将信号传递给制定进程：kill -SIGUSR1 [进程号]
4. 进程创建(fork)的时候，子进程会继承父进程的信号处理方式。因为子进程在开始时复制父进程的内存映像。

**7.3 中断的系统调用**

1. 低速系统调用：可能会使进程永远阻塞的一种系统调用
    1. 如果某些类型文件(管道、终端设备或网络设备)的数据不存在，则读操作可能会使调用者永远阻塞。
    2. 如果数据不能被相同的类型文件立即接受，则写操作可能会使调用者永远阻塞
    3. 在某种条件发生之前打开某些类型的文件，可能会阻塞(例如要打开一个终端设备，需要先等待与之链接的调制解调器应答)
    4. pause函数和wait函数
    5. 某些ioctl函数
    6. 某些进程的通信函数
2. 与磁盘IO相关的系统调用不属于低速系统调用。

**7.4 可重入函数**

1. 可重入的函数也被称为异步信号安全的函数。在信号处理函数中，调用的可重入函数不会破坏主进程本身。
2. 不可重入的函数：
    1. 使用了静态数据结构
    2. 调用了malloc或free
    3. 标准IO函数。标准IO库很多实现都以不可重入的方式使用全局数据结构
3. errno每个线程只有一个。作为一个通用的规则，信号处理函数调用可能会改变errno的函数是，应在调用前保存errno，调用后恢复





















